{% extends "base.html" %}
{% block title %}Preview · Sistema de gestión de tarjetas{% endblock %}

{% block content %}
<div class="content-container">

  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
    <div>
      <div class="page-title mb-0">Preview</div>
      <div class="text-muted small">
        Token: <span class="fw-semibold">{{ token }}</span>
        {% if created_at %}· {{ created_at }}{% endif %}
      </div>
    </div>

    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('importar') }}">
      <i class="fa-solid fa-arrow-left me-1"></i> Volver
    </a>
  </div>

  <!-- Ontracking -->
  <div class="p-3 bg-white border rounded-3 mb-3">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
      <div class="fw-semibold">
        <i class="fa-solid fa-bed me-2"></i>Ontracking <span class="text-muted">({{ ocup_n }})</span>
      </div>
      {% if ocup_n > 0 %}
      <a class="btn btn-outline-primary btn-sm" href="{{ url_for('descargar_csv', token=token, dataset='ocupacion') }}">
        <i class="fa-solid fa-download me-1"></i> CSV
      </a>
      {% endif %}
    </div>

    {% if ocup_n > 0 %}
    <div class="table-responsive">
      <table class="data-table">
        <thead><tr>{% for c in ocup_cols %}<th>{{ c }}</th>{% endfor %}</tr></thead>
        <tbody>
          {% for r in ocup_rows %}
          <tr>{% for c in ocup_cols %}<td>{{ r.get(c, '') }}</td>{% endfor %}</tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="text-muted small">Sin datos.</div>
    {% endif %}
  </div>

  <!-- Log Tarjetas -->
  <div class="p-3 bg-white border rounded-3 mb-3">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
      <div class="fw-semibold">
        <i class="fa-solid fa-id-card me-2"></i>Log Tarjetas <span class="text-muted">({{ log_n }})</span>
      </div>
      {% if log_n > 0 %}
      <a class="btn btn-outline-primary btn-sm" href="{{ url_for('descargar_csv', token=token, dataset='log_tarjetas') }}">
        <i class="fa-solid fa-download me-1"></i> CSV
      </a>
      {% endif %}
    </div>

    {% if log_n > 0 %}
    <div class="table-responsive">
      <table class="data-table">
        <thead><tr>{% for c in log_cols %}<th>{{ c }}</th>{% endfor %}</tr></thead>
        <tbody>
          {% for r in log_rows %}
          <tr>{% for c in log_cols %}<td>{{ r.get(c, '') }}</td>{% endfor %}</tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="text-muted small">Sin datos.</div>
    {% endif %}
  </div>

  <!-- Mapa -->
  <div class="p-3 bg-white border rounded-3">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
      <div class="fw-semibold">
        <i class="fa-solid fa-map-location-dot me-2"></i>Mapa <span class="text-muted">({{ map_n }})</span>
      </div>
      {% if map_n > 0 %}
      <a class="btn btn-outline-primary btn-sm" href="{{ url_for('descargar_csv', token=token, dataset='map_habitaciones') }}">
        <i class="fa-solid fa-download me-1"></i> CSV
      </a>
      {% endif %}
    </div>

    {% if map_n > 0 %}
    <div class="table-responsive">
      <table class="data-table">
        <thead><tr>{% for c in map_cols %}<th>{{ c }}</th>{% endfor %}</tr></thead>
        <tbody>
          {% for r in map_rows %}
          <tr>{% for c in map_cols %}<td>{{ r.get(c, '') }}</td>{% endfor %}</tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="text-muted small">Sin datos.</div>
    {% endif %}
  </div>

</div>
{% endblock %}
